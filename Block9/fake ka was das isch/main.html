<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>jsonplaceholder posts</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <h1>Posts von JSONplaceholder</h1>

  <!-- Login form -->
  <div id="login-form" class="post">
    <h2>Login</h2>
    <form id="login">
      <input type="number" name="userid" placeholder="User ID" min="1" max="100" required>
      <button type="submit">Login</button>
    </form>
  </div>

  <!-- User info display after login -->
  <div id="user-info" class="user-info" style="display: none;">
    <p>Logged in as User ID: <span id="current-user-id"></span></p>
    <button id="logout-btn">Logout</button>
  </div>

  <!-- Post form (initially hidden) -->
  <form id="form" class="post" style="display: none;">
    <input type="text" name="title" placeholder="Title" required>
    <textarea name="body" placeholder="body" required></textarea>
    <button type="submit">send</button>
  </form>

  <div id="demo"></div>

  <script>
    const form = document.getElementById("form");
    const demo = document.getElementById("demo");
    const loginForm = document.getElementById("login");
    const loginContainer = document.getElementById("login-form");
    const userInfo = document.getElementById("user-info");
    const currentUserIdSpan = document.getElementById("current-user-id");
    const logoutBtn = document.getElementById("logout-btn");

    let currentUserId = null;

    async function sendPost(title, body) {
      const response = await fetch("https://jsonplaceholder.typicode.com/posts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          title: title,
          body: body,
          userId: currentUserId
        })
      });

      const result = await response.json();
      console.log("Server replied:", result);

      const postEl = createPostElement(result);
      demo.prepend(postEl);
    }

    function createPostElement(post) {
      const postDiv = document.createElement("div");
      postDiv.className = "post";
      postDiv.dataset.postId = post.id;

      const title = document.createElement("h3");
      title.textContent = post.title;

      const body = document.createElement("p");
      body.textContent = post.body;

      const buttonsDiv = document.createElement("div");
      buttonsDiv.className = "post-buttons";

      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.className = "edit-btn";
      editBtn.onclick = () => enableEdit(postDiv, post);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "delete-btn";
      deleteBtn.onclick = () => deletePost(post.id, postDiv);

      buttonsDiv.appendChild(editBtn);
      buttonsDiv.appendChild(deleteBtn);

      postDiv.appendChild(title);
      postDiv.appendChild(body);
      postDiv.appendChild(buttonsDiv);
      return postDiv;
    }

    function enableEdit(postDiv, post) {
      const title = postDiv.querySelector('h3');
      const body = postDiv.querySelector('p');
      const buttonsDiv = postDiv.querySelector('.post-buttons');

      // Create input fields
      const titleInput = document.createElement('input');
      titleInput.type = 'text';
      titleInput.value = title.textContent;
      titleInput.className = 'edit-input';

      const bodyTextarea = document.createElement('textarea');
      bodyTextarea.value = body.textContent;
      bodyTextarea.className = 'edit-textarea';

      // Replace elements with inputs
      postDiv.replaceChild(titleInput, title);
      postDiv.replaceChild(bodyTextarea, body);

      // Create save and cancel buttons
      buttonsDiv.innerHTML = '';

      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'Save';
      saveBtn.className = 'save-btn';
      saveBtn.onclick = () => saveEdit(post.id, postDiv, titleInput.value, bodyTextarea.value);

      const cancelBtn = document.createElement('button');
      cancelBtn.textContent = 'Cancel';
      cancelBtn.className = 'cancel-btn';
      cancelBtn.onclick = () => cancelEdit(postDiv, post);

      buttonsDiv.appendChild(saveBtn);
      buttonsDiv.appendChild(cancelBtn);
    }

    function cancelEdit(postDiv, originalPost) {
      // Restore original content
      const titleInput = postDiv.querySelector('.edit-input');
      const bodyTextarea = postDiv.querySelector('.edit-textarea');
      const buttonsDiv = postDiv.querySelector('.post-buttons');

      const title = document.createElement('h3');
      title.textContent = originalPost.title;

      const body = document.createElement('p');
      body.textContent = originalPost.body;

      postDiv.replaceChild(title, titleInput);
      postDiv.replaceChild(body, bodyTextarea);

      // Restore original buttons
      buttonsDiv.innerHTML = '';

      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.className = "edit-btn";
      editBtn.onclick = () => enableEdit(postDiv, originalPost);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "delete-btn";
      deleteBtn.onclick = () => deletePost(originalPost.id, postDiv);

      buttonsDiv.appendChild(editBtn);
      buttonsDiv.appendChild(deleteBtn);
    }

    async function saveEdit(postId, postDiv, newTitle, newBody) {
      try {
        const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${postId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            id: postId,
            title: newTitle,
            body: newBody,
            userId: currentUserId
          })
        });

        const result = await response.json();
        console.log("Update response:", result);

        // Update the post element with new data
        const updatedPost = { id: postId, title: newTitle, body: newBody, userId: currentUserId };
        const newPostElement = createPostElement(updatedPost);
        postDiv.parentNode.replaceChild(newPostElement, postDiv);

      } catch (error) {
        console.error("Error updating post:", error);
      }
    }

    async function deletePost(postId, postDiv) {
      if (confirm('Are you sure you want to delete this post?')) {
        try {
          const response = await fetch(`https://jsonplaceholder.typicode.com/posts/${postId}`, {
            method: "DELETE"
          });

          if (response.ok) {
            postDiv.remove();
            console.log(`Post ${postId} deleted successfully`);
          }
        } catch (error) {
          console.error("Error deleting post:", error);
        }
      }
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      let title = form.title.value.trim();
      let body = form.body.value.trim();
      sendPost(title, body);
      form.reset();
    });

    // Login functionality
    loginForm.addEventListener("submit", function (e) {
      e.preventDefault();
      currentUserId = parseInt(loginForm.userid.value);
      currentUserIdSpan.textContent = currentUserId;

      // Hide login form, show user info and post form
      loginContainer.style.display = "none";
      userInfo.style.display = "block";
      form.style.display = "flex";

      // Reload posts with current user filter
      loadPosts();
    });

    // Logout functionality
    logoutBtn.addEventListener("click", function () {
      currentUserId = null;

      // Show login form, hide user info and post form
      loginContainer.style.display = "block";
      userInfo.style.display = "none";
      form.style.display = "none";

      // Clear posts
      demo.innerHTML = "";
    });

    async function loadPosts() {
      const response = await fetch("https://jsonplaceholder.typicode.com/posts", {
        method: "GET",
        headers: {
          "Content-Type": "application/json"
        }
      });
      const posts = await response.json();

      // Clear existing posts
      demo.innerHTML = "";

      // Filter posts by current user ID
      const userPosts = posts.filter(post => post.userId === currentUserId);

      userPosts.forEach(post => {
        const postEl = createPostElement(post);
        demo.appendChild(postEl);
      });

      console.log(response);
    }
  </script>

</body>

</html>